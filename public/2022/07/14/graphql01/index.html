<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="Sam"><meta name="copyright" content="Sam"><meta name="generator" content="Hexo 6.2.0"><meta name="theme" content="hexo-theme-yun"><title>GraphQL 的 Queries 和 Mutations | CoffeeTea</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.3.3/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/svg+xml" href="/public/yun.svg"><link rel="mask-icon" href="/public/yun.svg" color="#0078E7"><link rel="preload" href="/public/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/public/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"samxu-tech.github.io","root":"/public/","title":"咖啡与茶的小站","version":"1.10.4","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"fireworks":{"colors":null},"vendors":{"darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/public/css/hexo-theme-yun.css"><script src="/public/js/hexo-theme-yun.js" type="module"></script><meta name="description" content="官方文档链接：Queries and Mutations  本文概述的都是最基础的查询语句，具体的建立连接和发送请求的方式可以查看 Apollo 相关文档  Fields (字段)在最简单的情况下，GraphQL 可以查询对象上的指定字段，看下下面这个简单的查询案例 123456789101112131415query {  hero {    name  }}### REULT ###{  &quot;d">
<meta property="og:type" content="article">
<meta property="og:title" content="GraphQL 的 Queries 和 Mutations">
<meta property="og:url" content="https://samxu-tech.github.io/public/2022/07/14/graphql01/index.html">
<meta property="og:site_name" content="CoffeeTea">
<meta property="og:description" content="官方文档链接：Queries and Mutations  本文概述的都是最基础的查询语句，具体的建立连接和发送请求的方式可以查看 Apollo 相关文档  Fields (字段)在最简单的情况下，GraphQL 可以查询对象上的指定字段，看下下面这个简单的查询案例 123456789101112131415query {  hero {    name  }}### REULT ###{  &quot;d">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-07-14T03:20:18.000Z">
<meta property="article:modified_time" content="2022-07-14T03:21:10.065Z">
<meta property="article:author" content="Sam">
<meta property="article:tag" content="graphql">
<meta name="twitter:card" content="summary"><script>(function() {
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script>
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/public/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/public/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/public/about/" title="Sam"><img width="96" loading="lazy" src="/public/img/avatar.png" alt="Sam"><span class="site-author-status" title="Happy">😄</span></a><div class="site-author-name"><a href="/public/about/">Sam</a></div><span class="site-name">CoffeeTea</span><sub class="site-subtitle">80% of your achievements will come from 20% of your efforts. Identify the tasks that are worth 20% of your effort and focus on them.</sub><div class="site-description">Travels, Cloud Native, Speech</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/public/" title="首页"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/public/archives/" title="归档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">18</span></a></div><div class="site-state-item"><a href="/public/categories/" title="分类"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">1</span></a></div><div class="site-state-item"><a href="/public/tags/" title="标签"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">12</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:settings-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/public/links/" title="我的小伙伴们" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Fields-%E5%AD%97%E6%AE%B5"><span class="toc-number">1.</span> <span class="toc-text">Fields (字段)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Arguments-%E5%8F%82%E6%95%B0"><span class="toc-number">2.</span> <span class="toc-text">Arguments (参数)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Operation-Name-%E6%93%8D%E4%BD%9C%E5%90%8D%E7%A7%B0"><span class="toc-number">3.</span> <span class="toc-text">Operation Name (操作名称)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Variables-%E5%8F%98%E9%87%8F"><span class="toc-number">4.</span> <span class="toc-text">Variables (变量)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Aliases-%E5%88%AB%E5%90%8D"><span class="toc-number">5.</span> <span class="toc-text">Aliases (别名)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fragments-%E7%89%87%E6%AE%B5"><span class="toc-number">6.</span> <span class="toc-text">Fragments (片段)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Directives-%E6%8C%87%E4%BB%A4"><span class="toc-number">7.</span> <span class="toc-text">Directives (指令)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mutations-%E5%8F%98%E6%9B%B4"><span class="toc-number">8.</span> <span class="toc-text">Mutations (变更)</span></a></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="https://samxu-tech.github.io/public/public/2022/07/14/graphql01/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Sam"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="CoffeeTea"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">GraphQL 的 Queries 和 Mutations</h1><div class="post-meta"><div class="post-time"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="创建时间：2022-07-14 11:20:18" itemprop="dateCreated datePublished" datetime="2022-07-14T11:20:18+08:00">2022-07-14</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><span class="icon iconify" data-icon="ri:folder-line"></span></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/public/categories/%E6%8A%80%E6%9C%AF/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">技术</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/public/tags/graphql/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">graphql</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><p>官方文档链接：<a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://graphql.org/learn/queries/">Queries and Mutations</a></p>
<p> 本文概述的都是最基础的查询语句，具体的建立连接和发送请求的方式可以查看 <a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://www.apollographql.com/">Apollo</a> 相关文档</p>
<hr>
<h3 id="Fields-字段"><a href="#Fields-字段" class="headerlink" title="Fields (字段)"></a>Fields (字段)</h3><p>在最简单的情况下，GraphQL 可以查询对象上的指定字段，看下下面这个简单的查询案例</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">query {</span><br><span class="line">  hero {</span><br><span class="line">    name</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">### REULT ###</span><br><span class="line"></span><br><span class="line">{</span><br><span class="line">  "data": {</span><br><span class="line">    "hero": {</span><br><span class="line">      "name": "R2-D2"</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>你可以很清楚地看见，返回的结果和查询的结构是一致的。</p>
<p> 在上面的案例中，就简单获取了 hero 的 name，但是某个查询的字段也可能是对象。下面这个例子就是字段嵌套子对象的情况。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">query {</span><br><span class="line">  hero {</span><br><span class="line">    name</span><br><span class="line">    # Queries can have comments!</span><br><span class="line">    friends {</span><br><span class="line">      name</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">### RESULT ###</span><br><span class="line"></span><br><span class="line">{</span><br><span class="line">  "data": {</span><br><span class="line">    "hero": {</span><br><span class="line">      "name": "R2-D2",</span><br><span class="line">      "friends": [</span><br><span class="line">        {</span><br><span class="line">          "name": "Luke Skywalker"</span><br><span class="line">        },</span><br><span class="line">        {</span><br><span class="line">          "name": "Han Solo"</span><br><span class="line">        },</span><br><span class="line">        {</span><br><span class="line">          "name": "Leia Organa"</span><br><span class="line">        }</span><br><span class="line">    ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>GraphQL 的查询语句会遍历字段中所有相近的对象，尽量让客户端在一个请求中获取大量的相关数据，而不是多次请求。</p>
<h3 id="Arguments-参数"><a href="#Arguments-参数" class="headerlink" title="Arguments (参数)"></a>Arguments (参数)</h3><p>在实际的请求过程中，我们都需要请求符合某个条件的指定数据，所以在 GraphQL 中我们也可以将参数传递给字段，就像下面这样：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">query {</span><br><span class="line">  human(id: "1000") {</span><br><span class="line">    name</span><br><span class="line">    height</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">### RESULT ###</span><br><span class="line"></span><br><span class="line">{</span><br><span class="line">  "data": {</span><br><span class="line">    "human": {</span><br><span class="line">      "name": "Luke Skywalker",</span><br><span class="line">      "height": 1.72</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Operation-Name-操作名称"><a href="#Operation-Name-操作名称" class="headerlink" title="Operation Name (操作名称)"></a>Operation Name (操作名称)</h3><p>上面的例子都是直接使用 query 这个关键字作为查询名称的（官方文档省略了前面的query）但是实际的开发过程中，肯定不希望代码描述太过模糊，所以可以给操作设定名称</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">query HeroNameAndFriends {</span><br><span class="line">  hero {</span><br><span class="line">    name</span><br><span class="line">    friends {</span><br><span class="line">      name</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>不光是 query 操作，后续的 mutation 和 subscription 都可以指定操作名称用于区分不同的条件语句。</p>
<h3 id="Variables-变量"><a href="#Variables-变量" class="headerlink" title="Variables (变量)"></a>Variables (变量)</h3><p>光能够指定明确的参数值肯定是不符合开发要求的，很多时候我们一个 query 语句肯定要给不同的参数值去查询的，这个时候就可以使用变量进行传参：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">query HeroNameAndFriends($episode: Episode) {</span><br><span class="line"> hero(episode: $episode) {</span><br><span class="line">   name</span><br><span class="line">   friends {</span><br><span class="line">     name</span><br><span class="line">   }</span><br><span class="line"> }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">--- variables ---</span><br><span class="line">{</span><br><span class="line"> "episode": "JEDI"</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">### RESULT ### </span><br><span class="line"></span><br><span class="line">{</span><br><span class="line"> "data": {</span><br><span class="line">   "hero": {</span><br><span class="line">     "name": "R2-D2",</span><br><span class="line">     "friends": [</span><br><span class="line">       {</span><br><span class="line">         "name": "Luke Skywalker"</span><br><span class="line">       },</span><br><span class="line">       {</span><br><span class="line">         "name": "Han Solo"</span><br><span class="line">       },</span><br><span class="line">       {</span><br><span class="line">         "name": "Leia Organa"</span><br><span class="line">       }</span><br><span class="line">     ]</span><br><span class="line">   }</span><br><span class="line"> }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>简单概括一下上面的例子：</p>
<ol>
<li>使用 $variableName 代替静态的查询值</li>
<li>将 $variableName 作为查询的形式参数</li>
<li>传递实参进入 $variableName</li>
</ol>
<p>另外和 JS 的函数传参一样，也可以给个默认的变量值</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">query HeroNameAndFriends($episode: Episode = JEDI) {</span><br><span class="line">  hero(episode: $episode) {</span><br><span class="line">    name</span><br><span class="line">    friends {</span><br><span class="line">      name</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Aliases-别名"><a href="#Aliases-别名" class="headerlink" title="Aliases (别名)"></a>Aliases (别名)</h3><p>上面所有例子的情况，都有一个默认的前提，那就是服务器端的字段和前端所需的字段都是吻合的。那如果要是前端所需的字段需要换个别名再去渲染那该怎么办呢？下面的例子就能满足这样的需求：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  empireHero: hero(episode: EMPIRE) {</span><br><span class="line">    name</span><br><span class="line">  }</span><br><span class="line">  jediHero: hero(episode: JEDI) {</span><br><span class="line">    name</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">### RESULT ###</span><br><span class="line"></span><br><span class="line">{</span><br><span class="line">  "data": {</span><br><span class="line">    "empireHero": {</span><br><span class="line">      "name": "Luke Skywalker"</span><br><span class="line">    },</span><br><span class="line">    "jediHero": {</span><br><span class="line">      "name": "R2-D2"</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>上面的例子就是，两个 hero 字段被重新换名了然后再返回给客户端。</p>
<h3 id="Fragments-片段"><a href="#Fragments-片段" class="headerlink" title="Fragments (片段)"></a>Fragments (片段)</h3><p>继续上面使用别名的场景，如果客户端给同一数据类型定义了两个不同的别名，然后又恰好不幸的是，查询的数据结构又很复杂，但是我们又不想再写一遍完全一样的数据结构怎么办？下面这个例子就能解决这种问题：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  leftComparison: hero(episode: EMPIRE) {</span><br><span class="line">    ...comparisonFields</span><br><span class="line">  }</span><br><span class="line">  rightComparison: hero(episode: JEDI) {</span><br><span class="line">    ...comparisonFields</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">fragment comparisonFields on Character {</span><br><span class="line">  name</span><br><span class="line">  appearsIn</span><br><span class="line">  friends {</span><br><span class="line">    name</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">### RESULT ###</span><br><span class="line"></span><br><span class="line">{</span><br><span class="line">  "data": {</span><br><span class="line">    "leftComparison": {</span><br><span class="line">      "name": "Luke Skywalker",</span><br><span class="line">      "appearsIn": [</span><br><span class="line">        "NEWHOPE",</span><br><span class="line">        "EMPIRE",</span><br><span class="line">        "JEDI"</span><br><span class="line">      ],</span><br><span class="line">      "friends": [</span><br><span class="line">        {</span><br><span class="line">          "name": "Han Solo"</span><br><span class="line">        },</span><br><span class="line">        {</span><br><span class="line">          "name": "Leia Organa"</span><br><span class="line">        },</span><br><span class="line">        {</span><br><span class="line">          "name": "C-3PO"</span><br><span class="line">        },</span><br><span class="line">        {</span><br><span class="line">          "name": "R2-D2"</span><br><span class="line">        }</span><br><span class="line">      ]</span><br><span class="line">    },</span><br><span class="line">    "rightComparison": {</span><br><span class="line">      "name": "R2-D2",</span><br><span class="line">      "appearsIn": [</span><br><span class="line">        "NEWHOPE",</span><br><span class="line">        "EMPIRE",</span><br><span class="line">        "JEDI"</span><br><span class="line">      ],</span><br><span class="line">      "friends": [</span><br><span class="line">        {</span><br><span class="line">          "name": "Luke Skywalker"</span><br><span class="line">        },</span><br><span class="line">        {</span><br><span class="line">          "name": "Han Solo"</span><br><span class="line">        },</span><br><span class="line">        {</span><br><span class="line">          "name": "Leia Organa"</span><br><span class="line">        }</span><br><span class="line">      ]</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>你可以看到上面就是客户端需要查询两派不同的 hero 但是它们的属性基本相同，这个时候我们肯定不希望重复地去写两次类型声明，这个时候我们就可以预设好一个 Fragments 去复用。另外如果你要在 Fragments 里使用变量也是可以的：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">query HeroComparison($first: Int = 3) {</span><br><span class="line"> leftComparison: hero(episode: EMPIRE) {</span><br><span class="line">   ...comparisonFields</span><br><span class="line"> }</span><br><span class="line"> rightComparison: hero(episode: JEDI) {</span><br><span class="line">   ...comparisonFields</span><br><span class="line"> }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">fragment comparisonFields on Character {</span><br><span class="line"> name</span><br><span class="line"> friendsConnection(first: $first) {</span><br><span class="line">   totalCount</span><br><span class="line">   edges {</span><br><span class="line">     node {</span><br><span class="line">       name</span><br><span class="line">     }</span><br><span class="line">   }</span><br><span class="line"> }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Directives-指令"><a href="#Directives-指令" class="headerlink" title="Directives (指令)"></a>Directives (指令)</h3><p>上面的变量的例子，已经能帮助我们动态地获取想要的后端数据了，但有时候我们还可能需要根据变量来动态地去更改我们的结构。例如，有时候渲染某个 UI 组件需要指定的条件，不符合这个条件我们就不渲染这个 UI 组件。下面这个例子就展示了如何使用 directives 关键字去动态地更改我们需要查询的数据结构：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">query Hero($episode: Episode, $withFriends: Boolean!) {</span><br><span class="line">  hero(episode: $episode) {</span><br><span class="line">    name</span><br><span class="line">    friends @include(if: $withFriends) {</span><br><span class="line">      name</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">--- variables ---</span><br><span class="line">{</span><br><span class="line">  "episode": "JEDI",</span><br><span class="line">  "withFriends": false</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">### RESULT ###</span><br><span class="line"></span><br><span class="line">{</span><br><span class="line">  "data": {</span><br><span class="line">    "hero": {</span><br><span class="line">      "name": "R2-D2"</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>简单解释一下上面这个例子，当 withFriends 的值为 false 时，该 hero 结构就不需要对应的 friends 属性了。</p>
<h3 id="Mutations-变更"><a href="#Mutations-变更" class="headerlink" title="Mutations (变更)"></a>Mutations (变更)</h3><p>刚刚所有的讨论都是围绕着请求数据，但我们肯定也需要一种能够修改服务器端数据的方法。在 REST 风格的请求方式下，尽管 GET 也能修改服务端数据，但通常情况下我们还是使用 POST  去修改服务端数据。GraphQL 也是类似的逻辑，虽然 query 也可以实现数据的写入，但任何的写入操作都应该用 mutation 关键字。</p>
<p>就像 query 一样，mutation 操作也可以返回指定的对象类型。它可以返回更新后的最新状态。样例如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">mutation CreateReviewForEpisode($ep: Episode!, $review: ReviewInput!) {</span><br><span class="line">  createReview(episode: $ep, review: $review) {</span><br><span class="line">    stars</span><br><span class="line">    commentary</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line">--- variables ---</span><br><span class="line">{</span><br><span class="line">  "ep": "JEDI",</span><br><span class="line">  "review": {</span><br><span class="line">    "stars": 5,</span><br><span class="line">    "commentary": "This is a great movie!"</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">### RESULT ###</span><br><span class="line"></span><br><span class="line">{</span><br><span class="line">  "data": {</span><br><span class="line">    "createReview": {</span><br><span class="line">      "stars": 5,</span><br><span class="line">      "commentary": "This is a great movie!"</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p> 这样我们在更新一个字段的时候，我们就可以在一次请求中更新并获取最新的值。<br> 另外需要注意的是：<strong>Query 操作是并行的，而 Mutation 操作是串行的</strong>，这就意味着如果你在一次 request 中发送两次 <code>CreateReviewForEpisode</code> ，那么第一次一定会在第二次开始之前结束，用以确保不阻塞自己。</p>
<p> 另外，如果你不能确定从服务端返回的是哪种类型的话，你还可以加上 <code>__typename</code> 这个字段 (两条下划线)。</p>
</div></section><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>Sam</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://samxu-tech.github.io/public/2022/07/14/graphql01/" title="GraphQL 的 Queries 和 Mutations">https://samxu-tech.github.io/public/2022/07/14/graphql01/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> 许可协议。</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/public/2022/07/14/graphql02/" rel="prev" title="获取 graphql schema 信息"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">获取 graphql schema 信息</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/public/2022/07/13/cloudnative/" rel="next" title="到底什么是“云原生”"><span class="post-nav-text">到底什么是“云原生”</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 – 2022 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> Sam</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v6.2.0</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.4</span></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a></body></html>